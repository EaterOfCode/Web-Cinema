<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Web Cinema</title>
</head>
<body>
    <script>
        var fs = require('fs');
        var WebCinema = require('./libs/index.js');
        var proj = false;
        //console.log(fs.readFileSync('./sample/main.js'));
        var projCode = fs.readFileSync('./sample/main.js').toString('utf8');
        eval("(function(project){" + projCode + "})(function(project){proj = project;});");
        document.title = "Web Cinema - " + proj.name;
        //var mainHTML = fs.readFileSync('./sample/' + proj.html).toString('utf8');
		var frameSkip = 1000/25;
        var time = 0;
		var gui = require('nw.gui');
		var wind = window.open('file://C:/Users/Eater/Documents/GitHub/Web-Cinema/sample/' + proj.html);
		var win = gui.Window.get(wind);
		win.hide();
		//win.hide();
		var time = 0;
		var next = function(){
			if(time <= proj.storyboard.duration){
				console.log(time);
				WebCinema.Engine.createFrame(wind, time, proj);
				win.capturePage(function(buff){
					fs.writeFileSync('./result/' + Math.floor(time) + '.png',new Buffer(buff.split(',')[1],'base64'));
					document.innerHTML = ((time/proj.storyboard.duration)*100) + '%';
					time+=frameSkip;
					next();
				},'png');
			}else{
				document.innerHTML = 'done';
			}
		};
    </script>
</body>
</html>
